<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHT85 Logger</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <h1 id="deviceId">SHT85 Logger</h1>
                <div class="status-bar">
                    <span id="liveStatus0" class="status-badge live-sensor">S0: --</span>
                    <span id="liveStatus1" class="status-badge live-sensor">S1: --</span>
                    <span id="liveStatus2" class="status-badge live-sensor">S2: --</span>
                    <span id="liveStatus3" class="status-badge live-sensor">S3: --</span>
                    <span id="timeStatus" class="status-badge status-warning">Time: --</span>
                    <span id="storageStatus" class="status-badge">Storage: --</span>
                </div>
                <div class="retention-bar">
                    <span id="capacityStatus" class="status-badge">Capacity: --</span>
                    <div class="retention-controls">
                        <label>Prune days:</label>
                        <input type="number" id="pruneDays" min="1" value="30">
                        <button id="pruneBtn" onclick="pruneLfs()" class="btn-secondary">Prune</button>
                    </div>
                </div>
            </div>
        </header>

        <div class="controls">
            <div class="time-range">
                <label>From:</label>
                <input type="datetime-local" id="fromDate">
                <label>To:</label>
                <input type="datetime-local" id="toDate">
            </div>
            <div class="quick-ranges">
                <button onclick="setQuickRange(1)">24h</button>
                <button onclick="setQuickRange(7)">7d</button>
                <button onclick="setQuickRange(30)">30d</button>
                <button onclick="setQuickRange(180)">6mo</button>
                <button onclick="setQuickRange(365)">1y</button>
            </div>
            <div class="actions">
                <button onclick="loadData()" class="btn-primary">Load</button>
                <button onclick="toggleAutoRefresh()" id="autoRefreshBtn" class="btn-secondary">Auto: 30s</button>
                <span id="dataCount" class="data-count">0 points</span>
            </div>
        </div>

        <div class="charts">
            <div class="chart-row">
                <div class="chart-container">
                    <h2>Sensor 0 – Temperature</h2>
                    <div id="tempChart0"></div>
                </div>
                <div class="chart-container">
                    <h2>Sensor 0 – Humidity</h2>
                    <div id="humChart0"></div>
                </div>
                <div class="sensor-options">
                    <span class="sensor-options-num">Sensor 0</span>
                    <span class="sensor-options-label">Sampling:</span>
                    <select id="sensor0Sampling" onchange="saveSensorSampling(0)">
                        <option value="10">10 s</option>
                        <option value="30">30 s</option>
                        <option value="60">1 min</option>
                        <option value="300">5 min</option>
                        <option value="600">10 min</option>
                        <option value="3600" selected>1 h</option>
                        <option value="21600">6 h</option>
                        <option value="86400">24 h</option>
                    </select>
                    <span class="sensor-options-label">Heat interval:</span>
                    <select id="sensor0HeatingInterval" onchange="onHeatingIntervalChange(0)">
                        <option value="0">Off</option>
                        <option value="300">5 min</option>
                        <option value="3600">1 h</option>
                        <option value="86400">24 h</option>
                    </select>
                    <span class="sensor-options-label">Duty cycle (%):</span>
                    <input type="number" id="sensor0HeatingDutyCycle" min="0" max="100" value="0" style="width:4em" onchange="saveSensorHeating(0)">
                    <button type="button" onclick="downloadCSV(0)" class="btn-small">Download CSV</button>
                </div>
            </div>
            <div class="chart-row">
                <div class="chart-container">
                    <h2>Sensor 1 – Temperature</h2>
                    <div id="tempChart1"></div>
                </div>
                <div class="chart-container">
                    <h2>Sensor 1 – Humidity</h2>
                    <div id="humChart1"></div>
                </div>
                <div class="sensor-options">
                    <span class="sensor-options-num">Sensor 1</span>
                    <span class="sensor-options-label">Sampling:</span>
                    <select id="sensor1Sampling" onchange="saveSensorSampling(1)">
                        <option value="10">10 s</option>
                        <option value="30">30 s</option>
                        <option value="60">1 min</option>
                        <option value="300">5 min</option>
                        <option value="600">10 min</option>
                        <option value="3600" selected>1 h</option>
                        <option value="21600">6 h</option>
                        <option value="86400">24 h</option>
                    </select>
                    <span class="sensor-options-label">Heat interval:</span>
                    <select id="sensor1HeatingInterval" onchange="onHeatingIntervalChange(1)">
                        <option value="0">Off</option>
                        <option value="300">5 min</option>
                        <option value="3600">1 h</option>
                        <option value="86400">24 h</option>
                    </select>
                    <span class="sensor-options-label">Duty cycle (%):</span>
                    <input type="number" id="sensor1HeatingDutyCycle" min="0" max="100" value="0" style="width:4em" onchange="saveSensorHeating(1)">
                    <button type="button" onclick="downloadCSV(1)" class="btn-small">Download CSV</button>
                </div>
            </div>
            <div class="chart-row">
                <div class="chart-container">
                    <h2>Sensor 2 – Temperature</h2>
                    <div id="tempChart2"></div>
                </div>
                <div class="chart-container">
                    <h2>Sensor 2 – Humidity</h2>
                    <div id="humChart2"></div>
                </div>
                <div class="sensor-options">
                    <span class="sensor-options-num">Sensor 2</span>
                    <span class="sensor-options-label">Sampling:</span>
                    <select id="sensor2Sampling" onchange="saveSensorSampling(2)">
                        <option value="10">10 s</option>
                        <option value="30">30 s</option>
                        <option value="60">1 min</option>
                        <option value="300">5 min</option>
                        <option value="600">10 min</option>
                        <option value="3600" selected>1 h</option>
                        <option value="21600">6 h</option>
                        <option value="86400">24 h</option>
                    </select>
                    <span class="sensor-options-label">Heat interval:</span>
                    <select id="sensor2HeatingInterval" onchange="onHeatingIntervalChange(2)">
                        <option value="0">Off</option>
                        <option value="300">5 min</option>
                        <option value="3600">1 h</option>
                        <option value="86400">24 h</option>
                    </select>
                    <span class="sensor-options-label">Duty cycle (%):</span>
                    <input type="number" id="sensor2HeatingDutyCycle" min="0" max="100" value="0" style="width:4em" onchange="saveSensorHeating(2)">
                    <button type="button" onclick="downloadCSV(2)" class="btn-small">Download CSV</button>
                </div>
            </div>
            <div class="chart-row">
                <div class="chart-container">
                    <h2>Sensor 3 – Temperature</h2>
                    <div id="tempChart3"></div>
                </div>
                <div class="chart-container">
                    <h2>Sensor 3 – Humidity</h2>
                    <div id="humChart3"></div>
                </div>
                <div class="sensor-options">
                    <span class="sensor-options-num">Sensor 3</span>
                    <span class="sensor-options-label">Sampling:</span>
                    <select id="sensor3Sampling" onchange="saveSensorSampling(3)">
                        <option value="10">10 s</option>
                        <option value="30">30 s</option>
                        <option value="60">1 min</option>
                        <option value="300">5 min</option>
                        <option value="600">10 min</option>
                        <option value="3600" selected>1 h</option>
                        <option value="21600">6 h</option>
                        <option value="86400">24 h</option>
                    </select>
                    <span class="sensor-options-label">Heat interval:</span>
                    <select id="sensor3HeatingInterval" onchange="onHeatingIntervalChange(3)">
                        <option value="0">Off</option>
                        <option value="300">5 min</option>
                        <option value="3600">1 h</option>
                        <option value="86400">24 h</option>
                    </select>
                    <span class="sensor-options-label">Duty cycle (%):</span>
                    <input type="number" id="sensor3HeatingDutyCycle" min="0" max="100" value="0" style="width:4em" onchange="saveSensorHeating(3)">
                    <button type="button" onclick="downloadCSV(3)" class="btn-small">Download CSV</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal (sampling interval, etc.) -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <h2>Settings</h2>
            <form id="settingsForm" onsubmit="saveSettings(event)">
                <div class="form-group">
                    <label>Sampling Interval:</label>
                    <div class="interval-input">
                        <input type="number" id="intervalValue" min="1" required>
                        <select id="intervalUnit" onchange="updateIntervalConstraints()">
                            <option value="seconds">Seconds</option>
                            <option value="minutes">Minutes</option>
                            <option value="hours" selected>Hours</option>
                            <option value="days">Days</option>
                        </select>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn-primary">Save</button>
                    <button type="button" onclick="closeSettings()" class="btn-secondary">Cancel</button>
                </div>
            </form>
            <div id="settingsError" class="error-message"></div>
        </div>
    </div>

    <!-- Sensors Modal (heating, sensor-specific options) -->
    <div id="sensorsModal" class="modal">
        <div class="modal-content">
            <h2>Sensors</h2>
            <form id="sensorsForm" onsubmit="saveSensors(event)">
                <div class="form-group">
                    <label>Sensor 0 heating:</label>
                    <span class="sensor-options-label">Heat interval:</span>
                    <select id="modalHeatingInterval0" onchange="onModalHeatingIntervalChange()">
                        <option value="0">Off</option>
                        <option value="300">5 min</option>
                        <option value="3600">1 h</option>
                        <option value="86400">24 h</option>
                    </select>
                    <span class="sensor-options-label">Duty cycle (%):</span>
                    <input type="number" id="modalHeatingDutyCycle0" min="0" max="100" value="0" style="width:4em">
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn-primary">Save</button>
                    <button type="button" onclick="closeSensors()" class="btn-secondary">Cancel</button>
                </div>
            </form>
            <div id="sensorsError" class="error-message"></div>
        </div>
    </div>

    <!-- Time Set Modal -->
    <div id="timeModal" class="modal">
        <div class="modal-content">
            <h2>Set Device Time</h2>
            <p>Device time is not set. Please set it now.</p>
            <button onclick="setDeviceTime()" class="btn-primary">Set Time from Browser</button>
            <div id="timeError" class="error-message"></div>
        </div>
    </div>

    <script src="/apexcharts.min.js"></script>
    <script src="/apexcharts-sync-plugin.js"></script>
    <script src="/app.js"></script>
</body>
</html>

